@startuml BlockUser

actor Admin
boundary "UserListPage" as View #lightblue
participant ":userRoute" as Route #lightblue
control "authMiddleware" as Auth #orange
control "userController" as Controller #lightblue
participant ":userService" as Service #lightblue
entity "userModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group Unblock User
Admin -> View: 1. Click "Unblock" on\n a User Management
activate Admin
activate View
View -> View: 2. Show confirmation dialog
activate View
deactivate View
opt User cancels
    View --> Admin: 2.1 Cancel unblock (dialog closed)
end

View -> Route: 3. PATCH /api/v1/user/:id/activate
activate Route
Route -> Auth: 4. authenticateUser(req) & authorizeRole()
activate Auth
ref over Auth : 5. 3.0 Verify Token & Check Role

opt Authentication/Authorization Failed
    Auth --> Route: 5.1. Return 401/403 Error
    Route --> View: 5.2. Show error
    View --> Admin: 5.3. Display error message
end
Auth --> Route: 6. User authenticated & authorized
deactivate Auth

Route -> Controller: 7. activateUser(req, res)
activate Controller

Controller -> Service: 8. activateUser(userId)
activate Service

Service -> Model: 9. updateUserStatus(userId, true)
activate Model

Model -> MongoDB: 10. Update user document\nset isActive = true
activate MongoDB

MongoDB --> Model: 11. Return update result
deactivate MongoDB

Model --> Service: 12. Return update status
deactivate Model

alt Unblock success
    Service --> Controller: 12.1. Return success
    Controller --> Route: 12.1.1. Return success

    Route --> View: 12.1.2. Update user row status

    View --> Admin: 12.1.3. Display "User Unblocked"

else User not found
    Service --> Controller:12.2. Return fail
    deactivate Service

    
    Controller --> Route: 12.2.1. Return fail
    deactivate Controller


    Route --> View: 12.2.2. Show "User not found"
    deactivate Route


    View --> Admin: 12.2.3. Display error message
    deactivate View
    deactivate Admin

end

end
@enduml
