@startuml UpdateIngredient

actor "Admin" as Admin
boundary "DishDetailPage" as View #lightblue
participant ":ingredientRoute" as Route #lightblue
control "ingredientValidation" as Validation #yellow
control "ingredientController" as Controller #lightblue
participant ":ingredientService" as Service #lightblue
entity "ingredientModel" as IngredientModel #lightblue
database "MongoDB" as MongoDB #yellow

group Update Ingredient

Admin -> View: 1. Click "Edit Ingredient" button
activate Admin
activate View

View -> Admin: 2. Show edit form with current data\n(dishId, name, quantity, isActive)

Admin -> View: 3. Modify fields and submit
View -> Route: 4. PUT /api/v1/ingredient/:id
activate Route

note right of Route: Body: {\n  dishId: "66574e301a6d1f001e8a1c01",\n  name: "Updated Garlic powder",\n  quantity: "2 tsp",\n  isActive: true\n}

Route -> Validation: 5. updateIngredient(req, res, next)
activate Validation

alt Validation Success
    Validation -> Controller: 6. next() - validation passed
    
    activate Controller
    Controller -> Service: 7. updateIngredient(ingredientId, updateData)
    activate Service
    
    Service -> IngredientModel: 8. updateIngredient(ingredientId, dataToUpdate)
    activate IngredientModel
    
    IngredientModel -> MongoDB: 9. ExecuteQuery()
    activate MongoDB
    
    alt Ingredient Found & Updated
        MongoDB --> IngredientModel: 10. Return updated ingredient
        
        IngredientModel --> Service: 11. Return updated ingredient
        
        Service --> Controller: 12. Return updated ingredient
        
        Controller --> Route: 13. Send 200 JSON response
        
        Route --> View: 14. Return success response
        
        View --> Admin: 15. Show success message & update ingredient display
        
    else Ingredient Not Found
        MongoDB --> IngredientModel: 10. Return null
        deactivate MongoDB
        
        IngredientModel --> Service: 11. Return null
        deactivate IngredientModel
        
        Service --> Controller: 12. Throw ApiError(404, "Ingredient not found!")
        deactivate Service
        
        Controller --> Route: 13. next(error)
        deactivate Controller
        
        Route --> View: 14. Return 404 error
        
        View --> Admin: 15. Show error message
    end
    
else Validation Failed
    Validation --> Route: 6. next(ApiError(422, validation errors))
    deactivate Validation
    
    Route --> View: 7. Return 422 validation errors
    deactivate Route
    
    View --> Admin: 8. Show validation error messages
    deactivate View
    deactivate Admin
end

end

@enduml