@startuml SearchIngredient

actor "User" as User
boundary "IngredientPage" as View #lightblue
participant ":ingredientRoute" as Route #lightblue
control "ingredientController" as Controller #lightblue
participant ":ingredientService" as Service #lightblue
entity "ingredientModel" as IngredientModel #lightblue
entity "dishModel" as DishModel #lightblue
database "MongoDB" as MongoDB #yellow

group Search Ingredient by Name

User -> View: 1. Enter ingredient name to find dishes
activate User
activate View

User -> View: 2. Click "Search Dishes by Ingredient"
View -> Route: 3. GET /api/v1/ingredient/search-dishes?name={searchName}
activate Route


Route -> Controller: 4. searchIngredientForDish(req, res, next)
activate Controller


Controller -> Service: 5. searchByName(name, sortBy, order)
activate Service

Service -> IngredientModel: 6. searchByName(name, sortBy, order)
activate IngredientModel

IngredientModel -> MongoDB: 7. ExecuteQuery()
activate MongoDB

alt Ingredients Found
    MongoDB --> IngredientModel: 8. Return matching ingredients array
    
    IngredientModel --> Service: 9. Return ingredients list with dishIds
    
    
    loop For each unique dishId
        Service -> DishModel: 10. getDetails(dishId)
        activate DishModel
        
        DishModel -> MongoDB: 11. ExecuteQuery()
        
        MongoDB --> DishModel: 12. Return dish details
        
        DishModel --> Service: 13. Return dish info
        deactivate DishModel
    end
    
    Service --> Controller: 14. Return dishes found by ingredient search
    
    Controller --> Route: 15. Send 200 JSON response

    Route --> View: 16. Return dish results
    
    View --> User: 17. Display dishes containing the searched ingredient
    
else No Ingredients Found
    MongoDB --> IngredientModel: 8. Return empty array
    deactivate MongoDB
    
    IngredientModel --> Service: 9. Return empty array
    deactivate IngredientModel
    
    Service --> Controller: 10. Throw ApiError(404, "No dishes found with this ingredient!")
    deactivate Service
    
    Controller --> Route: 11. next(error)
    deactivate Controller
    
    Route --> View: 12. Return 404 error
    deactivate Route
    
    View --> User: 13. Show "No dishes found containing this ingredient"
    deactivate View
    deactivate User
end

end

@enduml