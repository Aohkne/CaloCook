@startuml ForgotPassword

actor User as "User/Admin"
boundary "ForgotPasswordPage" as View #lightblue
participant ":authRoute" as Route #lightblue
control "authController" as Controller #lightblue
participant ":authService" as Service #lightblue
entity "userModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow
participant ":EmailService" as Mailer #pink

group Forgot Password
User -> View: 1.Enter email to reset password
activate View

View -> View: 2.Validate email input
View -> Route: 3.POST /api/v1/auth/forgotPassword
activate Route

Route -> Controller: 4.forgotPassword(req, res)
activate Controller

Controller -> Service: 5.forgotPassword(email)
activate Service

Service -> Model: 6.findUserByEmail(email)
activate Model

Model -> MongoDB: 7.ExecuteQuery()
activate MongoDB
MongoDB --> Model: 8.Return user
deactivate MongoDB

Model --> Service: 9.Return user
deactivate Model

alt Email not registered
    Service --> Controller: 9.1.Return error "Email not found"
    deactivate Service

    Controller --> Route: 9.1.1. 404 Not Found
    deactivate Controller

    Route --> View: 9.1.2.Show "Email not found"
    deactivate Route

    View --> User: 9.1.3.Display error
else Email found

    Service -> Mailer: 10.Send reset email with token/link
    activate Mailer

    Mailer --> Service: 11.Email sent
    deactivate Mailer

    Service --> Controller: 12.Return success
    deactivate Service

    Controller --> Route: 13.Return success
    deactivate Controller

    Route --> View: 14. Show success
    deactivate Route

    View --> User: 15.Display "Please check your email"
end

deactivate View
end
@enduml
