@startuml ViewAllHistory

actor User as "Customer"
boundary "History Page" as View #lightblue
participant ":historyRoute" as Route #lightblue
control "authMiddleware" as Auth #Orange
control "historyController" as Controller #lightblue
participant ":historyService" as Service #lightblue
entity "historyModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group View History List
User -> View: 1. Click the History icon (clock icon) 
activate View
activate User

View -> Route: 2. GET /api/v1/history
activate Route

Route -> Auth: 3. authenticateUser(req) & authorizeRole()
    activate Auth
    ref over Auth : 4. Verify Token & Check Role

    opt Authentication/Authorization Failed
        Auth --> Route: 4.1. Return 401/403 Error
        Route --> View: 4.2. Show error
        View --> User: 4.3. Display error message
    end
    Auth --> Route: 5. User authenticated & authorized
    deactivate Auth

Route -> Controller: 6. getHistory(req, res)
activate Controller

Controller -> Service: 7. getHistory(userId)
activate Service

Service -> Model: 8. viewHistory(userId)
activate Model

Model -> MongoDB: 9. Query user history
activate MongoDB
MongoDB --> Model: 10. Return result
deactivate MongoDB

Model --> Service: 11. Return data
deactivate Model

alt History List is Empty
    Service --> Controller: 11.1. Return data

    Controller --> Route: 11.1.1. Send response

    Route --> View: 11.1.2. Update UI

    View --> User: 11.1.3. Show "No history found"

else History Found
    Service --> Controller: 11.2. Return data
    deactivate Service
    Controller --> Route: 11.2.1. Send response
    deactivate Controller

    Route --> View: 11.2.2. Update UI
    deactivate Route

    View --> User: 11.2.3. Show all history
    deactivate View
    deactivate User
end
 
end
@enduml
