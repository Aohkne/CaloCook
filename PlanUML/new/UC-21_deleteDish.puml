@startuml Deactivate Dish

actor Admin as "Admin"
boundary "DishListView" as View #lightblue
participant "dishRoute" as Route #lightblue
control "authMiddleware" as Auth #Orange
participant "dishController" as Controller #lightblue
participant "dishService" as Service #lightblue
participant "dishModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group Deactivate Dish
Admin -> View: 1. Click "Delete" on dish
activate Admin
activate View
View -> View: 2. Show confirmation dialog
activate View
deactivate View

opt User cancels
    View --> Admin: 2.1 Cancel deletion (dialog closed)
end
View -> Route: 3. PATCH /api/v1/dish/:id/delete
activate Route
activate Route
Route -> Auth: 4. authenticateUser(req) & authorizeRole()
activate Auth
ref over Auth : 5. 3.0 Verify Token & Check Role

opt Authentication/Authorization Failed
    Auth --> Route: 5.1. Return 401/403 Error
    Route --> View: 5.2. Show error
    View --> Admin: 5.3. Display error message
end
Auth --> Route: 6. User authenticated & authorized
deactivate Auth
Route -> Controller: 7. deactivateDish(req, res)
activate Controller

Controller -> Service: 8. deactivateDish(dishId)
activate Service

Service -> Model: 9. updateDishStatus(dishId, isActive=false)
activate Model

Model -> MongoDB: 10. Update { isActive: false }
activate MongoDB
MongoDB --> Model: 11. Return update result
deactivate MongoDB

alt Dish not found
    Model --> Service: 11.1. Return null
    Service --> Controller: 11.1.1. 404 Not Found
    Controller --> Route: 11.1.2. 404 Not Found
    Route --> View: 11.1.3. Show "Dish not found"
    View --> Admin: 11.1.4. Display error
else Deactivation success
    Model --> Service: 11.2. Return success
    deactivate Model
    Service --> Controller: 11.2.1. 200 OK
    deactivate Service
    Controller --> Route: 11.2.2. Return success
    deactivate Controller
    Route --> View: 11.2.3. Update dish status on UI
    deactivate Route
    View --> Admin: 11.2.4. Show "Dish deactivated"
    deactivate View
    deactivate Admin
end

end
@enduml
