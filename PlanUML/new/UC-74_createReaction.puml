@startuml CreateReaction

actor User as "User"
boundary "Dish Detail Page" as View #lightblue
participant ":reactionRoute" as Route #lightblue
control "authMiddleware" as Auth #Orange
control "reactionController" as Controller #lightblue
participant ":reactionService" as Service #lightblue
entity "reactionCommentModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group Create Raction
    User -> View: 1. Click "Like" icon and select icon
    activate User
    activate View

    View --> View: 2. Show icon list
    activate View
    deactivate View

    View -> Route: 3. POST /api/v1/reaction { commentId, reactionType }
    activate Route
    Route -> Auth: 4. authenticateUser(req) & authorizeRole()
    activate Auth
    ref over Auth : 5. Verify Token & Check Role

    opt Authentication/Authorization Failed
        Auth --> Route: 5.1. Return 401/403 Error
        Route --> View: 5.2. Show error
        View --> User: 5.3. Display error message
    end
    Auth --> Route: 6. User authenticated & authorized
    deactivate Auth

    Route -> Controller: 7. addReaction(req, res)
    activate Controller

    Controller -> Service: 8. addReaction(reactionData, userId)
    activate Service

    Service -> Model: 9. addReaction(reactionData, userId)
    activate Model

    Model -> MongoDB: 10. Insert new reaction
    activate MongoDB
    MongoDB --> Model: 11. Return created reaction
    deactivate MongoDB

    Model --> Service: 12. Return result
    deactivate Model

    Service --> Controller: 13. Return created reaction
    deactivate Service

    Controller --> Route: 14. 201 Created + reaction
    deactivate Controller

    Route --> View: 15. Render created reaction
    deactivate Route

    View --> User: 16. Display created reaction by the comment
    deactivate View
    deactivate User
end 


@enduml