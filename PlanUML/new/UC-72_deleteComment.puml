@startuml DeleteComment

actor User as "User"
boundary "Dish Detail Page" as View #lightblue
participant ":commentRoute" as Route #lightblue
control "authMiddleware" as Auth #Orange
control "commentController" as Controller #lightblue
participant ":commentService" as Service #lightblue
entity "commentModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group Delete Comment
    User -> View: 1. Click "Delete" on a comment box
    activate User
    activate View

    View -> View: 2. Show delete confirmation dialog

    opt Cancel Delete
        View --> User: 2.1. Close delete confirmation dialog
    end

    View -> Route: 3. DELETE /api/v1/comment { commentId }
    activate Route
    Route -> Auth: 4. authenticateUser(req) & authorizeRole()
    activate Auth
    ref over Auth : 5. Verify Token & Check Role
    opt Authentication/Authorization Failed
        Auth --> Route: 5.1. Return 401/403 Error
        Route --> View: 5.2. Show error
        View --> User: 5.3. Display error message
    end
    Auth --> Route: 6. User authenticated & authorized
    deactivate Auth

    Route -> Controller: 7. deleteCommentById(req, res)
    activate Controller

    Controller -> Service: 8. deleteCommentById(commentId)
    activate Service

    Service -> Model: 9. deleteCommentById(commentId)
    activate Model

    Model -> MongoDB: 10. Delete existing comment
    activate MongoDB
    MongoDB --> Model: 11. Return deleted comment
    deactivate MongoDB

    Model --> Service: 12. Return result
    deactivate Model

    alt Delete Comment Failed
        Service --> Controller: 12.1. Return error

        Controller --> Route: 12.1.1. 500 Internal Server Error

        Route --> View: 12.1.2. Display error message

        View --> User: 12.1.3. Display failure message
    else Delete Comment Succeeded
        Service --> Controller: 12.2. Return deleted comment
        deactivate Service

        Controller --> Route: 12.2.1. 200 OK + deleted comment
        deactivate Controller

        Route --> View: 12.2.2. Display message "deleted comment successfully"
        deactivate Route

        View --> User: 12.2.3. Display success message
        deactivate View
        deactivate User
    end
end 


@enduml