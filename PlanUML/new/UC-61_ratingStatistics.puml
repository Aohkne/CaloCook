@startuml Get Top Rated Dishes Statistics

actor Admin as "Admin"
boundary "AdminDashboard" as View #lightblue
participant ":dashboardRoute" as Route #lightblue
control "authMiddleware" as Auth #orange
control "ratingController" as Controller #lightblue
participant ":ratingService" as Service #lightblue
entity "ratingModel" as RatingModel #lightgreen
database "MongoDB" as MongoDB #yellow

Group Get Top 10 Rated Dishes
    Admin -> View: 1. Request top rated dishes
    activate Admin
    activate View

    View -> Route: 2. GET /api/v1/dashboard/top-ratings\n(query: limit)
    activate Route

    Route -> Auth: 3. authenticateUser(req) &\nauthorizeRole(['admin'])
    activate Auth

    ref over Auth : 4. 3.0 Verify Token & Check Role

    opt Authentication/Authorization Failed
        Auth --> Route: 4.1. Return 401/403 Error
        Route --> View: 4.2. Show error
        View --> Admin: 4.3. Display error message
    end

    Auth --> Route: 5. User authenticated & authorized
    deactivate Auth

    Route -> Controller: 6. getTopRatings(req, res)
    activate Controller

    Controller -> Service: 7. getTopRatings(limit)
    activate Service

    Service -> RatingModel: 8. getTopRatings(limit)
    activate RatingModel

    RatingModel -> MongoDB: 9. Query for top rated dishes
    activate MongoDB

    MongoDB --> RatingModel: 10. Return topRatings array
    deactivate MongoDB

    RatingModel --> Service: 11. Return topRatings array
    deactivate RatingModel

    opt No rated dishes found (array is empty)
        Service --> Controller: 11.1. Throw 404 Error
        Controller --> Route: 11.2. Return 404 Error
        Route --> View: 11.3. Show error message
        View --> Admin: 11.4. Display "No rated dishes found!"
    end

    Service --> Controller: 12. Return topRatings array
    deactivate Service

    Controller --> Route: 13. Return 200 OK (data: topRatings)
    deactivate Controller

    Route --> View: 14. Return top dishes data
    deactivate Route

    View --> Admin: 15. Display top rated dishes
    deactivate Admin
    deactivate View

end

@enduml