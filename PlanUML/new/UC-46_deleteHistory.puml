@startuml DeleteHistory

actor User as "Customer"
boundary "HistoryPage" as View #lightblue
participant ":historyRoute" as Route #lightblue
control "authMiddleware" as Auth #Orange
control "historyController" as Controller #lightblue
participant ":historyService" as Service #lightblue
entity "historyModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group Delete History
User -> View: 1. Click "Delete" icon (trashcan icon)
activate View
activate User

View -> View: 2. Show confirmation dialog
activate View
deactivate View

opt User cancels deletion
    View -->> User: 2.1. User cancels deletion
end


View -> Route: 3. DELETE /api/v1/history/:id
activate Route
Route -> Auth: 4. authenticateUser(req) & authorizeRole()
    activate Auth
    ref over Auth : 5. Verify Token & Check Role

    opt Authentication/Authorization Failed
        Auth --> Route: 5.1. Return 401/403 Error
        Route --> View: 5.2. Show error
        View --> User: 5.3. Display error message
    end
    Auth --> Route: 6. User authenticated & authorized
    deactivate Auth


Route -> Controller: 7. deleteHistory(req, res)
activate Controller

Controller -> Service: 8. deleteHistory(id)
activate Service

Service -> Model: 9. deleteHistoryById(id)
activate Model

Model -> MongoDB: 10. Delete document
activate MongoDB
MongoDB --> Model: 11. Return delete result
deactivate MongoDB

Model --> Service: 12. Return result
deactivate Model

alt Eat history not found
    Service --> Controller: 12.1. Return null

    Controller --> Route: 12.1.1. 404 Not Found

    Route --> View: 12.1.2. Show "History not found"

    View --> User: 12.1.3. Display error
else Deletion success
    Service --> Controller: 12.2. Return success
    deactivate Service

    Controller --> Route: 12.2.1. Send response
    deactivate Controller

    Route --> View: 12.2.2. Update UI
    deactivate Route

    View --> User: 12.2.3. Show "Deleted successfully"

    deactivate View
    deactivate User
end
end
@enduml
