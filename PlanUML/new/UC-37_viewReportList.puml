@startuml ViewReportList

actor Admin
boundary "Admin Dashboard" as View #lightblue
participant ":reportRoute" as Route #lightblue
control ":authMiddleware" as Auth #Orange
control "reportController" as Controller #lightblue
participant ":reportService" as Service #lightblue
entity "reportModel" as Model #lightblue
entity "userModel" as User #lightblue
entity "dishModel" as Dish #lightblue
database "MongoDB" as MongoDB #yellow

group View Report List
Admin -> View: 1. Click "View Report List"
activate Admin
activate View

View -> Route: 2. GET /api/v1/report
activate Route

Route -> Auth: 3. authenticateUser(req) & authorizeRole()
activate Auth
ref over Auth : 4. 3.0 Verify Token & Check Role

opt Authentication/Authorization Failed
    Auth --> Route: 4.1. Return 401/403 Error
    Route --> View: 4.2. Show error
    View --> Admin: 4.3. Display error message
end
Auth --> Route: 5. User authenticated & authorized
deactivate Auth

Route -> Controller: 6. getAllReport(req, res)
activate Controller

Controller -> Service: 7. getAllReport()
activate Service

Service -> Model: 8. fetchReports()
activate Model
Model -> MongoDB: 9. Query all reports
activate MongoDB
MongoDB --> Model: 10. Return report list
deactivate MongoDB
Model --> Service: 11. Return report list
deactivate Model

Service -> User: 12. fetchUserDetails(userId)
activate User
User -> MongoDB: 13. Query user
activate MongoDB
MongoDB --> User: 14. Return user details
deactivate MongoDB
User --> Service: 15. Return user details
deactivate User

Service -> Dish: 16. fetchDishDetails(dishId)
activate Dish
Dish -> MongoDB: 17. Query dish
activate MongoDB
MongoDB --> Dish: 18. Return dish details
deactivate MongoDB
Dish --> Service: 19. Return dish details
deactivate Dish

alt Reports available
    Service --> Controller: 19.1. Return reports + details
    Controller --> Route: 19.1.1. Return 200 OK {reports}
    Route --> View: 19.1.2. Render report list
    View --> Admin: 19.1.3. Show reports with user & dish details
else No reports found
    Service --> Controller: 19.2. Return empty result
    deactivate Service
    Controller --> Route: 19.2.1. Return 200 OK {empty}
    deactivate Controller
    Route --> View: 19.2.2. Show "No reports found"
    deactivate Route
    View --> Admin: 19.2.3. Display empty list message
    deactivate View
    deactivate Admin
end

deactivate Service
deactivate Controller
deactivate Route
deactivate View
deactivate Admin
end
@enduml
