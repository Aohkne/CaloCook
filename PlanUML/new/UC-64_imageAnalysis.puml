@startuml Get AI Assistant Response (Image Analysis)

actor User as "User"
boundary "GeminiChat" as View #lightblue
participant ":callGeminiAPI" as APIHandler #lightblue
participant ":GoogleGenerativeAI" as SDK #lightgreen
database "Gemini AI Server" as GeminiServer #yellow

Group AI Assistant Chat (Image Analysis)
    User -> View: 1. Uploads image (click or drag-drop)
    activate User
    activate View

    View -> View: 2. handleImageUpload()
    activate View
    deactivate View

    View -> View: 3. Read image as Base64 (FileReader)
    activate View
    deactivate View

    User -> View: 4. Enters question (text)
    User -> View: 5. Clicks Send

    View -> APIHandler: 6. callGeminiAPI(input, selectedImage)
    activate APIHandler

    APIHandler -> SDK: 7. new GoogleGenerativeAI(API_KEY)
    activate SDK

    APIHandler -> SDK: 8. getGenerativeModel({ model: VITE_MODEL }) 'vision model'

    SDK --> APIHandler: 9. Return model instance
    deactivate SDK

    APIHandler -> APIHandler: 10. Prepare multi-modal content (PROMPT + text + image data)
    activate APIHandler
    deactivate APIHandler

    APIHandler -> GeminiServer: 11. model.generateContent(content)
    activate GeminiServer

    GeminiServer --> APIHandler: 12. Return message
    deactivate GeminiServer
    
    opt API Error
        APIHandler --> View: 12.1. Return error string ("Sorry, I've been a bit busy...")
        View --> User: 12.2. Display error message
    end
    
    APIHandler --> View: 13. Return response
    deactivate APIHandler
    
    View --> User: 14. Display full response
    deactivate User
    deactivate View

end
@enduml