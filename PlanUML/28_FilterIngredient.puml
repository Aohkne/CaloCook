@startuml FilterIngredient

actor "User" as User
boundary "IngredientPage" as View #lightblue
participant ":ingredientRoute" as Route #lightblue
control "ingredientController" as Controller #lightblue
participant ":ingredientService" as Service #lightblue
entity "ingredientModel" as IngredientModel #lightblue
entity "dishModel" as DishModel #lightblue
database "MongoDB" as MongoDB #yellow

group Filter Ingredients

User -> View: 1. Open filter panel to find dishes by ingredients
activate User
activate View

User -> View: 2. Enter ingredient name
User -> View: 3. Click "Find Dishes"

View -> Route: 4. GET /api/v1/ingredient/?name={searchName}
activate Route

Route -> Controller: 5. searchIngredientForDish(req, res, next)
activate Controller

Controller -> Service: 6. searchByName(name, sortBy, order)
activate Service

Service -> IngredientModel: 7. searchByName(name, sortBy, order)
activate IngredientModel


IngredientModel -> MongoDB: 8. ExecuteQuery()
activate MongoDB

MongoDB --> IngredientModel: 9. Return filtered ingredients

alt Results Found
    IngredientModel --> Service: 10. Return filtered ingredients with dishIds
    
    
    loop For each unique dishId
        Service -> DishModel: 11. getDetails(dishId)
        activate DishModel
        
        DishModel -> MongoDB: 12. ExecuteQuery()
        
        MongoDB --> DishModel: 13. Return dish details
        deactivate MongoDB
        
        DishModel --> Service: 14. Return dish info
        deactivate DishModel
    end
    
    Service --> Controller: 15. Return dishes found by ingredient filter
    
    Controller --> Route: 16. Send 200 JSON response
    
    Route --> View: 17. Return filtered dish results
    
    View --> User: 18. Display dishes containing filtered ingredients
    
else No Results Found
    IngredientModel --> Service: 10. Return empty array
    deactivate IngredientModel
    
    Service --> Controller: 11. Throw ApiError(404, "No dishes found with these ingredient criteria!")
    deactivate Service
    
    Controller --> Route: 12. next(error)
    deactivate Controller
    
    Route --> View: 13. Return 404 error
    deactivate Route
    
    View --> User: 14. Show "No dishes match the ingredient filter criteria"
    deactivate View
    deactivate User
end

end

@enduml