@startuml UpdateStep

actor "Admin" as Admin
boundary "StepEditPage" as View #lightblue
participant ":stepRoute" as Route #lightblue
participant ":stepValidation" as Validation #orange
control "stepController" as Controller #lightblue
participant ":stepService" as Service #lightblue
entity "stepModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group Update Step
Admin -> View: 1. Edit step form and submit
activate Admin
activate View

View -> Route: 2. PUT /api/v1/step/:id
activate Route

Route -> Validation: 3. updateStep validation
activate Validation

Validation -> Validation: 4. Validate dishId, stepNumber, description, isActive

alt Validation Success
    Validation -> Controller: 5. updateStep(req, res)
    activate Controller

    Controller -> Service: 6. updateStep(stepId, updateData)
    activate Service

    Service -> Model: 7. updateStep(stepId, dataToUpdate)
    activate Model

    Model -> MongoDB: 8. ExecuteQuery()
    activate MongoDB

    MongoDB --> Model: 9. Return updated step 
    deactivate MongoDB


    alt Step Found and Updated
        Model --> Service: 10. Return updated step

        Service --> Controller: 11. Return updated step

        Controller --> Route: 12. Send JSON response (200, updated step)

        Route --> View: 13. Show success message

        View --> Admin: 14. Display updated step

    else Step Not Found
        Model --> Service: 9.1 Step Not Found
        deactivate Model

        Service --> Controller: 9.2 Throw ApiError(404, "Step not found!")
        deactivate Service

        Controller --> Route: 9.3 next(error)
        deactivate Controller

        Route --> View: 9.4 Return 404 error

        View --> Admin: 9.5 Show error message
    end

else Validation Failed
    Validation --> Route: 4.1 Throw validation error
    deactivate Validation

    Route --> View: 4.2 Return validation error
    deactivate Route

    View --> Admin: 4.3 Display validation errors
    deactivate View
    deactivate Admin
end

end

@enduml