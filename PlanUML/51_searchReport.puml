@startuml SearchReportByDish

actor Admin
boundary "Report Dashboard" as View #lightblue
participant ":reportRoute" as Route #lightblue
control ":authMiddleware" as Auth #Orange
control "reportController" as Controller #lightblue
participant ":reportService" as Service #lightblue
entity "reportModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group Search Report by Dish Name
Admin -> View: 1. Enter dish name and click "Search"
activate Admin
activate View

View -> Route: 2. GET /api/v1/report/search?dishName={keyword}
activate Route

Route -> Auth: 3. authenticateUser(req) & authorizeRole()
activate Auth
ref over Auth : 4. 3.0 Verify Token & Check Role

opt Authentication/Authorization Failed
    Auth --> Route: 4.1. Return 401/403 Error
    Route --> View: 4.2. Show error
    View --> Admin: 4.3. Display error message
end
Auth --> Route: 5. User authenticated & authorized
deactivate Auth

Route -> Controller: 6. getAllReports(req, res)
activate Controller

Controller -> Service: 7. getAllReports(keyword)
activate Service

alt Empty search field (AF2)
    Service -> Model: 7.1. getAllReports()
    activate Model
    Model -> MongoDB: 7.1.1. Query all reports
    activate MongoDB
    MongoDB --> Model: 7.1.2. Return all reports
    deactivate MongoDB
    Model --> Service: 7.1.3. Return reports
    deactivate Model
else Keyword entered
    Service -> Model: 7.2. getAllReports(keyword)
    activate Model
    Model -> MongoDB: 7.2.1. Execute query (case-insensitive, partial match) [BR1]
    activate MongoDB
    MongoDB --> Model: 7.2.2. Return matching reports
    deactivate MongoDB
    Model --> Service: 7.2.3. Return results
    deactivate Model
end

alt No matching reports (AF1)
    Service --> Controller: 8.1. Return empty result
    Controller --> Route: 8.1.1 Return { "message": "No reports found for this dish" }
    Route --> View: 8.1.2 Show "No reports found for this dish"
    View --> Admin: 8.1.3 Display empty result
else Reports found
    Service --> Controller: 8.2. Return reports
    deactivate Service
    Controller --> Route: 8.2.1 Return success {reports}
    deactivate Controller
    Route --> View: 8.2.2 Render report list
    deactivate Route
    View --> Admin: 8.2.3 Show reports with dish details
    deactivate View
    deactivate Admin
end

end
@enduml
