@startuml DeleteStep

actor "Admin" as Admin
boundary "StepManagementPage" as View #lightblue
participant ":stepRoute" as Route #lightblue
control "stepController" as Controller #lightblue
participant ":stepService" as Service #lightblue
entity "stepModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group Delete Step (Deactivate)
Admin -> View: 1. Click Delete/Deactivate Step
activate Admin
activate View

View -> View: 2. Show confirmation dialog
activate View
deactivate View

opt User cancels
    View --> Admin: 2.1 Cancel deletion (dialog closed)
end

View -> Route: 3. PATCH /api/v1/step/:id/deactivate
activate Route

Route -> Controller: 4. deactivateStep(req, res)
activate Controller

Controller -> Service: 5. deactivateStep(stepId)
activate Service

Service -> Model: 6. updateIsActive(stepId, false)
activate Model

Model -> MongoDB: 7. ExecuteQuery()
activate MongoDB

MongoDB --> Model: 8. Return updated step or null
deactivate MongoDB
Model --> Service: 9. Return deactivated step
deactivate Model

Service --> Controller: 10. Return deactivated step

Controller --> Route: 11. Send JSON response (200, deactivated step)

Route --> View: 12. Show success message

View --> Admin: 13. Display step as inactive/deleted

end

group Alternative: Activate Step
Admin -> View: 14. Click Activate Step

View -> Route: 15. PATCH /api/v1/step/:id/activate

Route -> Controller: 16. activateStep(req, res)

Controller -> Service: 17. activateStep(stepId)

Service -> Model: 18. updateIsActive(stepId, true)
activate Model

Model -> MongoDB: 19. ExecuteQuery()
activate MongoDB

MongoDB --> Model: 20. Return updated step or null
deactivate MongoDB

Model --> Service: 21. Return activated step
deactivate Model

Service --> Controller: 22. Return activated step
deactivate Service

Controller --> Route: 23. Send JSON response (200, activated step)
deactivate Controller

Route --> View: 24. Show success message
deactivate Route

View --> Admin: 25. Display step as active
deactivate View
deactivate Admin
end

@enduml