@startuml DeleteStep

actor "Admin" as Admin
boundary "StepManagementPage" as View #lightblue
participant ":stepRoute" as Route #lightblue
control "stepController" as Controller #lightblue
participant ":stepService" as Service #lightblue
entity "stepModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group Delete Step (Deactivate)
Admin -> View: 1. Click Delete/Deactivate Step
activate Admin
activate View

View -> Route: 2. PATCH /api/v1/step/:id/deactivate
activate Route

Route -> Controller: 3. deactivateStep(req, res)
activate Controller

Controller -> Service: 4. deactivateStep(stepId)
activate Service

Service -> Model: 5. updateIsActive(stepId, false)
activate Model

Model -> MongoDB: 6. ExecuteQuery()
activate MongoDB

MongoDB --> Model: 7. Return updated step or null

alt Step Found and Deactivated
    Model --> Service: 8. Return deactivated step
    
    Service --> Controller: 9. Return deactivated step
    
    Controller --> Route: 10. Send JSON response (200, deactivated step)
    
    Route --> View: 11. Show success message
    
    View --> Admin: 12. Display step as inactive/deleted

else Step Not Found
    Model --> Service: 7.1 Return null
    
    Service --> Controller: 7.2 Throw ApiError(404, "Step not found!")
    
    Controller --> Route: 7.3 next(error)
    
    Route --> View: 7.4 Return 404 error
    
    View --> Admin: 7.5 Show error message
end

end

group Alternative: Activate Step
Admin -> View: 13. Click Activate Step

View -> Route: 14. PATCH /api/v1/step/:id/activate

Route -> Controller: 15. activateStep(req, res)

Controller -> Service: 16. activateStep(stepId)

Service -> Model: 17. updateIsActive(stepId, true)

Model -> MongoDB: 18. ExecuteQuery()

MongoDB --> Model: 19. Return updated step or null
deactivate MongoDB

alt Step Found and Activated
    Model --> Service: 20. Return activated step
    
    Service --> Controller: 21. Return activated step
    
    Controller --> Route: 22. Send JSON response (200, activated step)
    
    Route --> View: 23. Show success message
    
    View --> Admin: 24. Display step as active

else Step Not Found
    Model --> Service: 19.1 Return null
    deactivate Model
    
    Service --> Controller: 19.2 Throw ApiError(404, "Step not found!")
    deactivate Service
    
    Controller --> Route: 19.3 next(error)
    deactivate Controller
    
    Route --> View: 19.4 Return 404 error
    deactivate Route
    
    View --> Admin: 19.5 Show error message
    deactivate View
    deactivate Admin
end

end

@enduml