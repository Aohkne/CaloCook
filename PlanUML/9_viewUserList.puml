@startuml ViewUserList

actor Admin
boundary "UserListPage" as View #lightblue
participant ":userRoute" as Route #lightblue
control "authMiddleware" as Auth #orange
control "userController" as Controller #lightblue
participant ":userService" as Service #lightblue
entity "userModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group View User List
Admin -> View: 1. Navigate to User Management
activate Admin
activate View

View -> Route: 2. GET /api/v1/user
activate Route
Route -> Auth: 3. authenticateUser(req) & authorizeRole()
activate Auth
ref over Auth : 4. 3.0 Verify Token & Check Role

opt Authentication/Authorization Failed
    Auth --> Route: 4.1. Return 401/403 Error
    Route --> View: 4.2. Show error
    View --> Admin: 4.3. Display error message
end
Auth --> Route: 5. User authenticated & authorized
deactivate Auth
Route -> Controller: 6. getAllUsers(req, res)
activate Controller

Controller -> Service: 7. getAllUsers()
activate Service

Service -> Model: 8. findAllUsers()
activate Model

Model -> MongoDB: 9. ExecuteQuery()
activate MongoDB
MongoDB --> Model: 10. Return result
deactivate MongoDB

Model --> Service: 11. Return user list data
deactivate Model

alt Users found
    Service --> Controller: 11.1. Return user list
    
    Controller --> Route: 11.1.1. Return user list
    
    Route --> View: 11.1.2. Render user list
    
    View --> Admin: 11.1.3. Display list of users
    
else Users not found
    Service --> Controller: 11.2. Return empty list
    deactivate Service

    Controller --> Route: 11.2.1. Empty list
    deactivate Controller
    
    Route --> View: 11.2.2. Show "No users found"
    deactivate Route
    
    View --> Admin: 11.2.3. Display empty state message
    deactivate View
    deactivate Admin

end

end
@enduml
