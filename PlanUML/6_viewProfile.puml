@startuml ViewProfile

actor User
boundary "Profile Page" as View #lightblue
participant ":authRoute" as Route #lightblue
control "authMiddleware" as Auth #orange
control "authController" as Controller #lightblue
participant ":authService" as Service #lightblue
entity "userModel" as Model #lightblue
database "MongoDB" as MongoDB #yellow

group View Profile
User -> View: 1.Click "Profile"
activate View
activate User

View -> Route: 2.GET /api/v1/auth/profile
activate Route
Route -> Auth: 3. authenticateUser(req) & authorizeRole()
activate Auth
ref over Auth : 4. 3.0 Verify Token & Check Role

opt Authentication/Authorization Failed
    Auth --> Route: 5.1. Return 401/403 Error
    Route --> View: 5.2. Show error
    View --> User: 5.3. Display error message
end
Auth --> Route: 6. User authenticated & authorized
deactivate Auth
Route -> Controller: 7.getProfile(req, res)
activate Controller

Controller -> Service: 8.getProfile(userId)
activate Service


    Service -> Model: 9.findUserById(userId)
    activate Model

    Model -> MongoDB: 10.ExecuteQuery()
    activate MongoDB
    MongoDB --> Model: 11.Return result
    deactivate MongoDB

    Model --> Service: 12.Return user data
    deactivate Model
alt Service returns profile
    Service --> Controller: 12.1. Return profile info

    Controller --> Route: 12.1.1. Return success

    Route --> View: 12.1.2. Render user profile

    View --> User: 12.1.3. Show profile on screen
else Service fails to load data
    Service --> Controller: 12.2. Return Error("Failed to load profile")
    deactivate Service

    Controller --> Route: 12.2.1. Return error message
    deactivate Controller

    Route --> View: 12.2.2. Render error view
    deactivate Route

    View --> User: 12.2.3. Show error "Failed to load."
    deactivate View
    deactivate User
end

end
@enduml
// ...existing code...