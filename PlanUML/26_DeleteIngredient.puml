@startuml DeleteIngredient

actor "Admin" as Admin
boundary "DishDetailPage" as View #lightblue
participant ":ingredientRoute" as Route #lightblue
control "ingredientController" as Controller #lightblue
participant ":ingredientService" as Service #lightblue
entity "ingredientModel" as IngredientModel #lightblue
database "MongoDB" as MongoDB #yellow

group Delete Ingredient - Deactivate

Admin -> View: 1. Click "Delete Ingredient" button
activate Admin
activate View

View -> Admin: 2. Show confirmation dialog

Admin -> View: 3. Confirm deletion
View -> Route: 4. PATCH /api/v1/ingredient/:id/deactivate
activate Route

note right of Route: Soft delete by setting\nisActive = false

Route -> Controller: 5. deactivateIngredient(req, res, next)
activate Controller

Controller -> Service: 6. deactivateIngredient(ingredientId)
activate Service

Service -> IngredientModel: 7. updateIsActive(ingredientId, false)
activate IngredientModel

IngredientModel -> MongoDB: 8. ExecuteQuery()
activate MongoDB
MongoDB --> IngredientModel: 9. Return update result

alt Ingredient Found & Deactivated
    IngredientModel --> Service: 10. Return ingredient
    
    Service --> Controller: 11. Return deactivated ingredient
    
    Controller --> Route: 12. Send 200 JSON response
    
    Route --> View: 13. Return success response
    
    View --> Admin: 14. Show success message\n& hide ingredient from active list
    
else Ingredient Not Found
    IngredientModel --> Service: 9.1 Return null
    
    Service --> Controller: 9.2 Throw ApiError(404, "Ingredient not found!")
    
    Controller --> Route: 9.3 next(error)
    
    Route --> View: 9.4 Return 404 error
    
    View --> Admin: 9.5 Show error message
end

end

group Alternative: Activate Ingredient (Restore)

Admin -> View: 15. View deactivated ingredients

Admin -> View: 16. Click "Restore Ingredient" button

View -> Route: 17. PATCH /api/v1/ingredient/:id/activate

Route -> Controller: 18. activateIngredient(req, res, next)

Controller -> Service: 19. activateIngredient(ingredientId)

Service -> IngredientModel: 20. updateIsActive(ingredientId, true)

IngredientModel -> MongoDB: 21. ExecuteQuery()

MongoDB --> IngredientModel: 22. Return update result
deactivate MongoDB

alt Ingredient Found & Activated
    IngredientModel --> Service: 23. Return activated ingredient

    Service --> Controller: 24. Return activated ingredient

    Controller --> Route: 25. Send 200 JSON response

    Route --> View: 26. Return success response

    View --> Admin: 27. Show success message\n& add ingredient back to active list

else Ingredient Not Found
    IngredientModel --> Service: 22.1 Return null
    deactivate IngredientModel
    
    Service --> Controller: 22.2 Throw ApiError(404, "Ingredient not found!")
    deactivate Service
    
    Controller --> Route: 22.3 next(error)
    deactivate Controller
    
    Route --> View: 22.4 Return 404 error
    deactivate Route
    
    View --> Admin: 22.5 Show error message
    deactivate View
    deactivate Admin
end

end

@enduml